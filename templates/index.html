{% extends "layout.html" %}
{% block app %}

<div id="index-page">
<div class="about">
<h3>Why Meta-Mar?</h3>
        <p> <b>Meta-Mar</b> is a free online meta-analysis service developed as an adjunctive tool for running a full meta-analysis (including meta-regression and subgroup analysis) or can be used as a calculator/convertor of effect sizes! </p>

<ul class="a">
          <li>Possibility of choosing the Data entry methods between <b>manual Data entry</b> or <b>.xlsx upload</b>.</li>
           <li>Calculation of effect sizes based on <b> <a href="/smd"> SMD </a></b>, <b> <a href="/corr"> Correlation </a></b> and <b> <a href="/ratios"> Ratios </a></b> models for every single study.</li>
           <li>Calculation of the overall effect size of the analysis based on fixed and random effect models.</li>
           <li>Calculation of <b>Fail-N Safe</b> based on fixed and random effect models.</li>
           <li>Calculation of <b>heterogeneity</b> of the analysis (<b>Q Cochrane</b>, <b>I<sup>2</b> and <b>Tau<sup>2</b>).</li>
           <li>Possibility of <b>meta regression</b> and <b>subgroup analysis</b>.</li>
           <li>Visualization of <b>Forest Plot</b> and <b>Funnel Plot</b>. </li>
           <li>Possibility of exporting the results of the analysis via a .xlsx file.</li>
           <li>Finally and regardless of your analysis, you may just want to use an <b><a href="/effect">Effect Size Calculator</a></b></li>
</ul>
<p></p>
<p></p>

        <center>
        <a href="/meta"> <b>Start Your Analysis! </b></a>
        </center>
</div>
        <p></p>
        <p></p>
</div>


<h4><b>Or take a look at a solved example by Meta-Mar:</b></h4>
<p></p>
<p></p>
<script>
  function printDiv(divName){
    var printContents = document.getElementById(divName).innerHTML;
    var originalContents = document.body.innerHTML;

    document.body.innerHTML = printContents;

    window.print();

    document.body.innerHTML = originalContents;

  }
</script>
<a href="/return-file-smdxl/" target="blank"><h5>Download the results as an Excel file</h5></a>
<button onclick="printDiv('printMe')" align="center"><b>Save the results as pdf</b></button>
<p></p>






<h4>Table.1 summary of studies</h4>
<div style="overflow-x:auto;">
  {{total}}
</div>
<p></p>
<p></p>
<h4>Table.2 Summary of results - fixed and random effect models</h4>
<div id="table" align="left">
  <table style="width:100%">
    <thead>
      <tr>
        <td>
          <center>
              <font color="black"> </font>
            </center>
        </td>

        <td>
          <center>
            <font color="#2E9AFE"> Hedges'g (SMD) </font>
          </center>
        </td>
        <td>
          <center>
            <font color="#2E9AFE"> SEg </font>
          </center>

        </td>
        <td>
          <center>
            <font color="#2E9AFE"> 95%CI </font>
          </center>
        </td>
        <td>
          <center>
            <font color="#2E9AFE"> z score </font>
          </center>
        </td>
        <td>
          <center>
            <font color="#2E9AFE"> p value </font>
          </center>
        </td>
        <td>
          <center>
            <font color="#2E9AFE"> Heterogeneity  </font>
          </center>
        </td>

      </tr>
    </thead>
    <tbody>
      <tr>
        <td>
          <center>
            <font color="#FF9900"> Fixed Effect Model </font>
          </center>
        </td>
        <td>
          <center>{{ave_g_fixed}}</center>
        </td>
        <td>
          <center>{{ave_SEg_fixed}} </center>
        </td>
        <td>
          <center>[{{lower_gg_fixed}},{{upper_gg_fixed}}] </center>
        </td>
        <td>
          <center>{{z_score_fixed}} </center>
        </td>
        <td>
          <center>{{p_value_fixed}} </center>
        </td>
        <td>
          <center>I<sup>2</sup>={{Het_fixed}}%, Chi<sup>2</sup>={{qq}}, df={{degf}} </center>
        </td>

      </tr>
      <tr>
        <td>
          <center>
            <font color="#FF9900"> Random Effect Model </font>
          </center>
        </td>
        <td>
          <center>{{ave_g_random}}</center>
        </td>
        <td>
          <center>{{ave_SEg_random}} </center>
        </td>
        <td>
          <center>[{{lower_gg_random}},{{upper_gg_random}}]</center>
        </td>
        <td>
          <center>{{z_score_random}} </center>
        </td>
        <td>
          <center>{{p_value_random}} </center>
        </td>
        <td>
          <center>I<sup>2</sup>={{Het_random}}%, Tau<sup>2</sup>={{t2}} </center>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<p></p>
<div id="printMe">
<div class="forest">
  <h4> Figure.1 Forestplot - fixed and random effect models</h4>
  <div id="fixedModelChartDiv"></div>
  <div id="randomModelChartDiv"></div>
</div>
<p></p>
<p></p>
<h4>Figure.2 Funnel Plot - fixed and random effect models </h4>
	<div id='myDiv0'><!-- Plotly chart will be drawn inside this DIV --></div>
  <p></p>
<div id='myDiv1'><!-- Plotly chart will be drawn inside this DIV --></div>
<p></p>
<h4>Table.3 Fail-N Safe </h4>
<p></p>
<b>Bias of the analysis regarding the file-drawer problem:</b><p></p>
Fail-N Safe, the number of studies (or samples) with a null effect (g = 0) <br> needed to bring the calculated significance level of the pooled effect (p value < {{p_val}}) near the critical significance level (p value = 0.05), <br> is calculated as follows:
<p></p>
References:<br>
* Rosenberg, M. S. (2005). The file‐drawer problem revisited: a general weighted method for calculating fail‐safe numbers in meta‐analysis. Evolution, 59(2), 464-468.
<br>
* Rosenthal, R. (1979). The file drawer problem and tolerance for null results. Psychological bulletin, 86(3), 638.
<div id="table" align="left">
  <table style="width:100%">

    <tbody>
      <tr>
        <td>
          <center>
              <font color="black"> <b></b> </font>
            </center>
        </td>

        <td>
          <center>
            <font color="#FF7F50"> Rosenthal (1979) </font> <br> t<sub>c</sub>(&alpha; = 0.05, df = {{n_study}}) = {{t_c}}
          </center>
        </td>
        <td>
          <center>
            <font color="#3CB371"> Rosenberg (2005) </font> <br> Z<sub>c</sub>(&alpha; = 0.05) = 1.645
          </center>

        </td>

      </tr>
      <tr>
        <td>
          <center>
              <font color="black"> <b>Fail-N Safe</b> </font>
            </center>
        </td>

        <td>
          <center>
            <font color="#2E9AFE"> {{fns_rosenthal}} </font>
          </center>
        </td>
        <td>
          <center>
            <font color="#2E9AFE"> {{fns_rosenberg}} </font>
          </center>

        </td>

      </tr>
    </tbody>
  </table>
</div>
<p></p>
<div class="regress" style="display:inline-block;">
  <p></p>
  <h4>Table.4 Results of Meta regression </h4>
  <p></p>
  <div style="overflow-x:auto;">
    {{moder | safe}}
  </div>
</div>
<p></p>
<p></p>
<h4>Table.5 Results of Subgroup Analysis - fixed and random effect models</h4>

<p></p>
<h5>fixed model</h5>
  {{total_fixed}}
<p></p>
<h5>random model</h5>
<p></p>
  {{total_random}}
<p></p>
<h5>Results of ANOVA for subgroups </h5>
<p> F value = {{fvalue}}, p value = {{pvalue}}</p>
<h4>Figure.3 Intervals of effect sizes for subgroups - fixed and random effect models</h4>
<script src="https://www.gstatic.com/charts/loader.js"></script>
<h5>fixed model</h5>
<div id="chart_div_fixed"></div>
<p></p>
<h5>random model</h5>
<div id="chart_div_random"></div>
<p></p>
<p></p>


<p></p>
<p></p>
</div>



{% endblock %}
{% block script %}
<script>
const study = {{study_list | safe}}
const g = {{g_list}}
const g_lower = {{g_lower_list}}
const g_upper = {{g_upper_list}}
const g_wf = {{weight_fixed_list}}
const g_w = {{weight_random_list}}
const list = []

let fixedModelChartData = []
let randomModelChartData = []

fixedModelChartData.push({
  "category": "",
  "measure": 0,
  "bullet": "",
  "bulletSize": 0,
  "high": 0,
  "low": 0
})


for (var i=0; i<g.length; i++) {
  fixedModelChartData.push({
    "category": study[i],
    "measure": g[i].toFixed(3),
    "bullet": "square",
    "bulletSize": g_wf[i].toFixed(0),
    "high": g_upper[i].toFixed(3),
    "low": g_lower[i].toFixed(3)
  })
}

fixedModelChartData.push({
  "category": "g(ave) fixed model",
  "measure": {{ave_g_fixed}},
  "bullet": "diamond",
  "bulletSize": 25,
  "high": {{upper_gg_fixed}},
  "low": {{lower_gg_fixed}}
})

AmCharts.makeChart("fixedModelChartDiv", {
  "type": "serial",
  "theme": "light",
  "rotate": true,
  "fontSize": 18,
  "categoryAxis": {
    "gridAlpha": 0,
  },
  "valueAxes": [{
    "guides": [{
      "value": 2.2,
      "dashLength": 3,
      "lineThickness": 2
    }]
  }],
  "chartCursor": {
    "fullWidth": true,
    "graphBulletSize": 1,
    "categoryBalloonEnabled": false,
    "cursorAlpha": 0.1
  },
  "dataProvider": fixedModelChartData,
  "graphs": [{
    "lineAlpha": 0,
    "bulletField": "bullet",
    "bulletSizeField": "bulletSize",
    "valueField": "measure",
    "lineColor": "#00c20d",
    "balloonText": "<strong>[[value]]</strong> 95%CI([[low]],[[high]])"
  }, {
    "type": "ohlc",
    "highField": "high",
    "lowField": "low",
    "openField": "measure",
    "closeField": "measure",
    "fixedColumnWidth": 1,
    "lineColor": "#00c20d",
    "showBalloon": false
  }],
  "categoryField": "category"
});


randomModelChartData.push({
  "category": "",
  "measure": 0,
  "bullet": "",
  "bulletSize": 0,
  "high": 0,
  "low": 0
})

for (var i = 0; i < g.length; i++) {
  randomModelChartData.push({
    "category": study[i],
    "measure": g[i].toFixed(3),
    "bullet": "square",
    "bulletSize": g_w[i].toFixed(0),
    "high": g_upper[i].toFixed(3),
    "low": g_lower[i].toFixed(3)
  })
}

randomModelChartData.push({
  "category": "g(ave) random model",
  "measure": {{ave_g_random}},
  "bullet": "diamond",
  "bulletSize": 25,
  "high": {{upper_gg_random}},
  "low": {{lower_gg_random}}
})

AmCharts.makeChart("randomModelChartDiv", {
  "type": "serial",
  "theme": "light",
  "rotate": true,
  "fontSize": 18,
  "categoryAxis": {
    "gridAlpha": 0,
  },
  "valueAxes": [{
    "guides": [{
      "value": 2.2,
      "dashLength": 3,
      "lineThickness": 2
    }]
  }],
  "chartCursor": {
    "fullWidth": true,
    "graphBulletSize": 1,
    "categoryBalloonEnabled": false,
    "cursorAlpha": 0.1
  },
  "dataProvider": randomModelChartData,
  "graphs": [{
    "lineAlpha": 0,
    "bulletField": "bullet",
    "bulletSizeField": "bulletSize",
    "valueField": "measure",
    "lineColor": "#00c20d",
    "balloonText": "<strong>[[value]]</strong> 95%CI([[low]],[[high]])"
  }, {
    "type": "ohlc",
    "highField": "high",
    "lowField": "low",
    "openField": "measure",
    "closeField": "measure",
    "fixedColumnWidth": 1,
    "lineColor": "#00c20d",
    "showBalloon": false
  }],
  "categoryField": "category"
});

</script>
<script type="text/javascript">
var gg = {{g_list}};
var sgg = {{seg_list}};
var g_ave = {{ave_g_random}};

  var trace1 = {
    x: gg,
    y: sgg,
    mode: 'markers',
    type: 'scatter',
    marker: { size: 12 },
    name: "Hedges' g"
  };
  var trace2 = {
    x: [g_ave, g_ave, g_ave],
    y: [0, 0.5, 1],
    mode: 'lines',
    type: 'scatter',
    name: ''
  };
  var trace3 = {
    x: [Math.min.apply(Math, gg)-0.5, g_ave, 2*g_ave - Math.min.apply(Math, gg)+0.5],
    y: [0, 1, 0],
    mode: 'lines',
    type: 'scatter',
    name: ''
  };
  var trace4 = {
    x: [g_ave, g_ave, g_ave],
    y: [0, 1, 2],
    mode: 'lines',
    type: 'scatter',
    name: ''
  };

  var data = [ trace1, trace2, trace3, trace4 ];

  var layout = {
    xaxis: {
      range: [ -6, 6 ]
    },
    yaxis: {
      range: [0, 1.5]
    },
    title:'Funnel Plot random model (Y: Standard Error (SEg) - X: Effect Size (g))'
  };

  Plotly.newPlot('myDiv0', data, layout);


</script>
<script>
  var gg = {{g_list}};
  var sgg = {{seg_list}};
  var g_ave_f = {{ave_g_fixed}};

    var trace1 = {
      x: gg,
      y: sgg,
      mode: 'markers',
      type: 'scatter',
      marker: { size: 12 },
      name: "Hedges' g"
    };
    var trace2 = {
      x: [g_ave_f, g_ave_f, g_ave_f],
      y: [0, 0.5, 1],
      mode: 'lines',
      type: 'scatter',
      name: ''
    };
    var trace3 = {
      x: [Math.min.apply(Math, gg)-0.5, g_ave_f, 2*g_ave_f - Math.min.apply(Math, gg)+0.5],
      y: [0, 1, 0],
      mode: 'lines',
      type: 'scatter',
      name: ''
    };
    var trace4 = {
      x: [g_ave_f, g_ave_f, g_ave_f],
      y: [0, 1, 2],
      mode: 'lines',
      type: 'scatter',
      name: ''
    };

    var data = [ trace1, trace2, trace3, trace4 ];

    var layout = {
      xaxis: {
        range: [ -6, 6 ]
      },
      yaxis: {
        range: [0, 1.5]
      },
      title:'Funnel Plot fixed model (Y: Standard Error (SEg) - X: Effect Size (g))'
    };

    Plotly.newPlot('myDiv1', data, layout);
</script>
  <script>
    google.charts.load('current', {
    callback: function () {
      var data = new google.visualization.DataTable();

      data.addColumn('string', 'Element');
      data.addColumn('number', 'effect size');
      data.addColumn({type: 'string', role: 'annotation'});
      data.addColumn({type: 'number', role: 'interval'});
      data.addColumn({type: 'number', role: 'interval'});
      data.addColumn('number', 'effect size');
      data.addColumn({type: 'number', role: 'interval'});
      data.addColumn({type: 'number', role: 'interval'});
  var list_gg_random = {{list_gg_random}};
  var ke_ke = {{ke_ke | safe}};
  var g_ave_r = {{ave_g_random}};
  var gg_low_random = {{gg_low_random}};
  var gg_upp_random = {{gg_upp_random}};
  arrSum = function(arr){
    return arr.reduce(function(a,b){
      return a + b
    }, 0);
    sum_gg_random = arrSum(list_gg_random)
  }
  for (var i=0; i<gg_low_random.length; i++) {
      data.addRows([
        [ke_ke[i], list_gg_random[i], '.', gg_low_random[i], gg_upp_random[i], list_gg_random[i], gg_low_random[i], gg_upp_random[i]]
      ])};

      var options = {
        annotations: {
          stem: {
            color: 'transparent',
            length: -6
          },
          textStyle: {
            auraColor: '#ffffff',
            color: '#000000'
          }
        },
        pointSize: 3,
        legend: 'none',
        orientation: 'horizontal',
        vAxis: {
          minValue: -1,
          ticks: [0, 1, 2, 3, parseInt(3+g_ave_r)],
          gridlines: {color: '#333', minSpacing: 1}
        },
      };

      var chart = new google.visualization.ScatterChart(document.getElementById('chart_div_random'));
      chart.draw(data, options);
    },
    packages: ['corechart']
  });
  </script>
  <script>
    google.charts.load('current', {
    callback: function () {
      var data = new google.visualization.DataTable();

      data.addColumn('string', 'Element');
      data.addColumn('number', 'effect size');
      data.addColumn({type: 'string', role: 'annotation'});
      data.addColumn({type: 'number', role: 'interval'});
      data.addColumn({type: 'number', role: 'interval'});
      data.addColumn('number', 'effect size');
      data.addColumn({type: 'number', role: 'interval'});
      data.addColumn({type: 'number', role: 'interval'});
  var list_gg_fixed = {{list_gg_fixed}};
  var ke_ke = {{ke_ke | safe}};
  var g_ave_f = {{ave_g_fixed}};

  var gg_low_fixed = {{gg_low_fixed}};
  var gg_upp_fixed = {{gg_upp_fixed}};
  arrSum = function(arr){
    return arr.reduce(function(a,b){
      return a + b
    }, 0);
    sum_gg_fixed = arrSum(list_gg_fixed)
  }
  for (var i=0; i<gg_low_fixed.length; i++) {
      data.addRows([
        [ke_ke[i], list_gg_fixed[i], '.', gg_low_fixed[i], gg_upp_fixed[i], list_gg_fixed[i], gg_low_fixed[i], gg_upp_fixed[i]]
      ])};

      var options = {
        annotations: {
          stem: {
            color: 'transparent',
            length: -6
          },
          textStyle: {
            auraColor: '#ffffff',
            color: '#000000'
          }
        },
        pointSize: 3,
        legend: 'none',
        orientation: 'horizontal',
        vAxis: {
          minValue: -1,
          ticks: [0, 1, 2, 3, parseInt(1+g_ave_f)],
          gridlines: {color: '#333', minSpacing: 1}
        },

      };

      var chart = new google.visualization.ScatterChart(document.getElementById('chart_div_fixed'));
      chart.draw(data, options);
    },
    packages: ['corechart']
  });
  </script>
{% endblock %}
