{% extends "layout.html" %}
{% block app %}

<a href="/return-file-corrxl/" target="blank"> <h4 align="center"><b>Download the results as an Excel file</h4></a>
<p></p>
<h4>Table.1 summary of studies</h4>
{{result_table}}
<p></p>
<h4>Table.2 Summary of results - fixed and random effect models</h4>
<div id="table" align="left">
  <table style="width:100%">
    <thead>
      <tr>
        <td>
          <center> <b> <font color="black">  </font> </b> </center>
        </td>

        <td>
          <center>
            <font color="#2E9AFE"> Fisher Z </font>
          </center>
        </td>
        <td>
          <center>
            <font color="#2E9AFE"> r </font>
          </center>
        </td>
        <td>
          <center>
            <font color="#2E9AFE"> SE </center>
          </font>
        </td>
        <td>
          <center>
            <font color="#2E9AFE"> 95%CI </font>
          </center>
        </td>
        <td>
          <center>
            <font color="#2E9AFE"> z score </font>
          </center>
        </td>
        <td>
          <center>
            <font color="#2E9AFE"> p value </font>
          </center>
        </td>
        <td>
          <center>
            <font color="#2E9AFE"> Heterogeneity (I<sup>2</sup>)</font>
          </center>
        </td>

      </tr>
    </thead>
    <tbody>
      <tr>
        <td> <center> <font color="#FF9900"> Fixed Effect Model </font> </center> </td>
        <td> <center>{{ave_z}}</center> </td>
        <td> <center>{{ave_r}} </center></td>
        <td> <center>{{ave_SE}} </center></td>
        <td> <center>[{{lower_r}},{{upper_r}}] </center></td>
        <td> <center>{{z_score}} </center></td>
        <td> <center>{{p_value}} </center></td>
        <td> <center>{{Het}}% </center></td>
      </tr>
      <tr>
        <td> <center> <font color="#FF9900"> Random Effect Model </font> </center> </td>
        <td> <center>{{ave_z_random}}</center> </td>
        <td> <center>{{ave_r_random}} </center></td>
        <td> <center>{{ave_SE_random}} </center></td>
        <td> <center>[{{lower_r_random}},{{upper_r_random}}] </center></td>
        <td> <center>{{z_score_random}} </center></td>
        <td> <center>{{p_value_random}} </center></td>
        <td> <center>{{Het}}%, T<sup>2</sup>={{t2}}</center></td>
      </tr>

    </tbody>
  </table>
</div>

  <p></p>

  <div class="forest">
        <h4> Fig.1 Forestplot - fixed and random effect models</h4>

        <div id="chartdiv"></div>
        <div id="chart2div"></div>

  </div>
  <p></p>
  <div class="regress" style="display:inline-block;">
  <p></p>
  <h4>Table.3 Results of Meta regression </h4>
  <div style="overflow-x:auto;">
        {{moder | safe}}
  </div></div>
  <p></p>
  <p></p>


{% endblock %}
{% block script %}
<script>

    const study = {{study_list | safe}}
    const r = {{r_list}}
    const r_lower = {{r_lower_list}}
    const r_upper = {{r_upper_list}}
    const rf_w = {{weight_fixed_list}}
    const r_w = {{weight_random_list}}
    const list = []

    var s=[]
    s.push({
    "category": "",
    "measure": 0,
    "bullet": "",
    "bulletSize": 0,
    "high": 0,
    "low": 0
    })
    for (var i=0; i<r.length; i++) {
     s.push({
        "category": study[i],
        "measure": r[i].toFixed(3),
        "bullet": "square",
        "bulletSize": rf_w[i].toFixed(0),
        "high": r_upper[i].toFixed(3),
        "low": r_lower[i].toFixed(3)
        })}
        s.push({
           "category": "r(ave) fixed model",
           "measure": {{ave_r}},
           "bullet": "diamond",
           "bulletSize": 25,
           "high": {{lower_r}},
           "low": {{upper_r}}
           })

    var chart = AmCharts.makeChart("chartdiv", {
    "type": "serial",
    "theme": "light",
    "rotate": true,
    "fontSize": 18,
    "categoryAxis": {
    "gridAlpha": 0,
    },
    "valueAxes": [{
    "guides": [{
    "value": 2.2,
    "dashLength": 3,
    "lineThickness": 2
    }]
    }],
    "chartCursor": {
    "fullWidth": true,
    "graphBulletSize": 1,
    "categoryBalloonEnabled": false,
    "cursorAlpha": 0.1
    },
    "dataProvider": s,
    "graphs": [{
    "lineAlpha": 0,
    "bulletField": "bullet",
    "bulletSizeField": "bulletSize",
    "valueField": "measure",
    "lineColor": "#00c20d",
    "balloonText": "<strong>[[value]]</strong> 95%CI([[low]],[[high]])"
    }, {
    "type": "ohlc",
    "highField": "high",
    "lowField": "low",
    "openField": "measure",
    "closeField": "measure",
    "fixedColumnWidth": 1,
    "lineColor": "#00c20d",
    "showBalloon": false
    }],
    "categoryField": "category"
    });

    var t=[]
    t.push({
    "category": "",
    "measure": 0,
    "bullet": "",
    "bulletSize": 0,
    "high": 0,
    "low": 0
    })
    for (var i=0; i<r.length; i++) {
     t.push({
        "category": study[i],
        "measure": r[i].toFixed(3),
        "bullet": "square",
        "bulletSize": r_w[i].toFixed(0),
        "high": r_upper[i].toFixed(3),
        "low": r_lower[i].toFixed(3)
        })}
        t.push({
           "category": "r(ave) random model",
           "measure": {{ave_r_random}},
           "bullet": "diamond",
           "bulletSize": 25,
           "high": {{lower_r_random}},
           "low": {{upper_r_random}}
           })

    var chart = AmCharts.makeChart("chart2div", {
    "type": "serial",
    "theme": "light",
    "rotate": true,
    "fontSize": 18,
    "categoryAxis": {
    "gridAlpha": 0,
    },
    "valueAxes": [{
    "guides": [{
    "value": 2.2,
    "dashLength": 3,
    "lineThickness": 2
    }]
    }],
    "chartCursor": {
    "fullWidth": true,
    "graphBulletSize": 1,
    "categoryBalloonEnabled": false,
    "cursorAlpha": 0.1
    },
    "dataProvider": t,
    "graphs": [{
    "lineAlpha": 0,
    "bulletField": "bullet",
    "bulletSizeField": "bulletSize",
    "valueField": "measure",
    "lineColor": "#00c20d",
    "balloonText": "<strong>[[value]]</strong> 95%CI([[low]],[[high]])"
    }, {
    "type": "ohlc",
    "highField": "high",
    "lowField": "low",
    "openField": "measure",
    "closeField": "measure",
    "fixedColumnWidth": 1,
    "lineColor": "#00c20d",
    "showBalloon": false
    }],
    "categoryField": "category"
    });
</script>
{% endblock %}
